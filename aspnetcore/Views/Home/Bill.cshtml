
@{
    ViewData["Title"] = "Bill";
}
@section header{
    <link href="~/lib/datetimepicker/bootstrap-datetimepicker.min.css" rel="stylesheet" />
}

<section class="content-header">
    <h1>
        账单
    </h1>
</section>
<section class="content" id="app">
    <div class="box">
        <div class="box-body">
            <div class="col-md-8">
                <a class="btn btn-primary btn-sm" v-on:click="showEditing">新增</a>
            </div>
            <div class="col-md-4">
                <div class="input-group">
                    <input type='text' class="form-control" id="datepicker" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
            </div>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>日期</th>
                        <th>金额</th>
                        <th>记录时间</th>
                        <th>备注</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(b,index) in Bills" :key="b.Id">
                        <td>{{index}}</td>
                        <td>{{billDate(b.PayDate)}}</td>
                        <td>{{b.Amount}}</td>
                        <td>{{b.LogTime}}</td>
                        <td>{{b.Remark}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div v-show="ShowEditing" class="box">
        <div class="box-body">
            <div class="form-group">
                <label for="txtPayDate">日期</label>
                <input type="text" id="txtPayDate" v-model="Editing.PayDate" class="form-control" style="width:600px;">
            </div>
            <div class="form-group">
                <label for="txtAmount">金额</label>
                <input type="text" id="txtAmount" v-model="Editing.Amount" class="form-control" style="width:600px;">
            </div>
            <div class="form-group">
                <label for="txtRemark">备注</label>
                <input type="text" id="txtRemark" v-model="Editing.Remark" class="form-control" style="width:600px;">
            </div>
        </div>
        <div class="box-footer">
            <a id="btnSave" v-on:click="newBill" class="btn btn-primary">保存</a>
        </div>
    </div>
</section>

@section footer{
    <script src="~/js/app.js"></script>
    <script src="~/lib/Vue/vue.js"></script>
    <script src="~/js/extend.js"></script>
    <script src="~/lib/datetimepicker/moment.min.js"></script>
    <script src="~/lib/datetimepicker/bootstrap-datetimepicker.js"></script>
    <script>
        $(function () {
            $('#datepicker').datetimepicker({
                format: "YYYY-MM-DD",
            }).on('dp.change', function (date) {
                console.log(date);
            });
        })

        var app = new Vue({
            el: '#app',
            data: {
                Bills: [],
                Editing: {},
                ShowEditing: false,
                PageIndex: 1,
                PageSize: 10
            },
            methods: {
                getBills: function () {
                    var $this = this;
                    ApiClient.Get('/api/bill', {
                        pageIndex: this.PageIndex,
                        pageSize: this.PageSize
                    }, function (e) {
                        if (e.status == 1) {
                            $this.Bills = e.data;
                        } else
                            alert(e.msg);
                    })
                },
                billDate: function (date) {
                    return date.substring(0, 10);
                },
                showEditing: function () {
                    this.ShowEditing = true;
                },
                newBill: function () {
                    var $this = this;
                    ApiClient.Post('/api/bill', this.Editing, function (e) {
                        if (e.status == 1) {
                            $this.getBills();
                        } else
                            alert(e.msg);
                    })
                }
            },
            created: function () {
                this.getBills();
            }
        })
    </script>
}